<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Luxury en-suite bathroom installation London. Free interactive 3D builder. Expert fitters Chelsea, Kensington, Notting Hill. 10-year guarantee.">
  <title>En-Suite Bathrooms | Free 3D Builder • Luxury Installation London</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.13.0/gsap.min.js"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@300;400;700&family=Inter:wght@300;400;500&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .serif { font-family: 'Playfair Display', serif; }
    .nav { background: rgba(255,255,255,0.98); backdrop-filter: blur(20px); }
    .gold { color: #d4af37; }
    .cream { background-color: #fbf7f0; }
    .section-title { font-size: 3.8rem; line-height: 1.05; font-weight: 300; letter-spacing: -3px; }

    .hero-video { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: 0; }
    .hero-overlay { position: absolute; inset: 0; background: linear-gradient(to bottom, rgba(0,0,0,0.25), rgba(0,0,0,0.5)); z-index: 1; }

    .water-stream { position: absolute; top: 38%; left: 48%; width: 4px; height: 180px; background: linear-gradient(transparent, #a5f3fc, #67e8f9); animation: waterFlow 0.8s linear infinite; opacity: 0.85; z-index: 5; }
    .bubbles { position: absolute; bottom: 0; left: 0; width: 100%; height: 60%; overflow: hidden; pointer-events: none; z-index: 6; }
    .bubble { position: absolute; bottom: -50px; background: rgba(255,255,255,0.75); border-radius: 50%; animation: bubbleRise linear infinite; }
    @keyframes bubbleRise { to { transform: translateY(-800px); opacity: 0; } }
    .steam { position: absolute; bottom: 25%; left: 50%; transform: translateX(-50%); pointer-events: none; z-index: 7; }
    .steam-particle { position: absolute; width: 10px; height: 10px; background: rgba(255,255,255,0.8); border-radius: 50%; animation: steamRise 4s infinite linear; }
    @keyframes steamRise { 0% { transform: translateY(0) scale(1); opacity: 0.9; } 100% { transform: translateY(-280px) scale(0.2); opacity: 0; } }

    #roomioBanner { animation: bannerFlash 1.6s infinite alternate ease-in-out; }
    @keyframes bannerFlash { from { box-shadow: 0 0 25px rgba(212,175,55,0.6); } to { box-shadow: 0 0 70px rgba(212,175,55,1); } }

    #threeCanvas { width: 100%; height: 560px; border: 8px solid #d4af37; border-radius: 24px; touch-action: none; }
    #selectedLabel { font-size: 1.25rem; font-weight: 700; color: #d4af37; text-align: center; height: 36px; }
  </style>
</head>
<body class="bg-[#fbf7f0] text-zinc-900">

  <!-- NAVBAR (unchanged) -->
  <nav class="nav fixed top-0 w-full z-50 border-b border-[#d4af37]/30 py-7">
    <div class="max-w-7xl mx-auto px-8 flex justify-between items-center">
      <div class="flex items-center gap-4">
        <i class="fa-solid fa-bath text-5xl gold"></i>
        <span class="text-4xl serif tracking-widest font-light">EN-SUITE</span>
      </div>
      <div class="hidden md:flex gap-10 text-lg font-light">
        <a href="#builder" class="hover:gold transition">Interactive Builder</a>
        <a href="#estimator" class="hover:gold transition">Instant Estimator</a>
        <a href="#areas" class="hover:gold transition">Areas</a>
        <a href="#quote" class="hover:gold transition">Contact</a>
      </div>
      <a href="#quote" class="bg-[#d4af37] hover:bg-amber-400 text-black font-medium px-10 py-4 rounded-full transition">BOOK FREE 3D</a>
    </div>
  </nav>

  <!-- HERO (unchanged) -->
  <header class="relative h-screen overflow-hidden flex items-center">
    <video autoplay loop muted playsinline class="hero-video">
      <source src="https://videos.pexels.com/video-files/6702578/6702578-uhd_2560_1440_25fps.mp4" type="video/mp4">
    </video>
    <div class="hero-overlay"></div>
    <div class="water-stream"></div>
    <div class="bubbles">
      <div class="bubble" style="left:22%; width:18px; height:18px; animation-duration:4.8s; animation-delay:0s"></div>
      <div class="bubble" style="left:35%; width:12px; height:12px; animation-duration:6.2s; animation-delay:0.5s"></div>
      <div class="bubble" style="left:48%; width:25px; height:25px; animation-duration:5.1s; animation-delay:1.2s"></div>
      <div class="bubble" style="left:61%; width:15px; height:15px; animation-duration:7s; animation-delay:0.3s"></div>
      <div class="bubble" style="left:74%; width:20px; height:20px; animation-duration:4.5s; animation-delay:1.8s"></div>
    </div>
    <div class="steam">
      <div class="steam-particle" style="left:-40px; animation-delay:0s"></div>
      <div class="steam-particle" style="left:-20px; animation-delay:0.6s"></div>
      <div class="steam-particle" style="left:10px; animation-delay:1.2s"></div>
      <div class="steam-particle" style="left:35px; animation-delay:0.4s"></div>
      <div class="steam-particle" style="left:60px; animation-delay:1.8s"></div>
    </div>

    <div class="max-w-6xl mx-auto px-8 text-white text-center z-10 relative">
      <h1 class="section-title text-7xl md:text-[5.8rem] serif leading-none mb-8" data-aos="fade-up">LONDON'S MOST LAVISH ENSUITES</h1>
      <p class="text-3xl max-w-3xl mx-auto mb-12" data-aos="fade-up" data-aos-delay="300">Free interactive 3D builder • Expert installation</p>
      <div class="flex flex-col md:flex-row gap-6 justify-center" data-aos="fade-up" data-aos-delay="500">
        <a href="#builder" class="bg-white text-black px-16 py-7 rounded-3xl text-2xl font-medium hover:scale-105 transition">START BUILDING NOW</a>
        <a href="#estimator" class="border-2 border-white px-16 py-7 rounded-3xl text-2xl font-medium hover:bg-white hover:text-black transition">INSTANT ESTIMATE</a>
      </div>
    </div>

    <div id="roomioBanner" class="fixed bottom-0 left-0 right-0 bg-gradient-to-r from-black via-zinc-950 to-black py-6 z-[9999] border-t-4 border-[#d4af37]">
      <div class="max-w-7xl mx-auto px-8 flex items-center justify-between text-white w-full">
        <span class="text-xl md:text-2xl serif tracking-wider text-[#d4af37]">en-suite not enough?</span>
        <span class="hidden md:block text-xl">turn your spare room into a studio apartment</span>
        <a href="https://www.roomio.studio" target="_blank" class="bg-[#d4af37] hover:bg-amber-400 text-black px-9 py-4 rounded-full font-semibold text-lg transition-all hover:scale-105">click here →</a>
        <button onclick="closeRoomioBanner()" class="text-5xl text-[#d4af37] hover:text-white ml-8 leading-none">×</button>
      </div>
    </div>
  </header>

  <!-- SIMPLE 3D PLANNER – FULLY FIXED -->
  <section id="builder" class="cream py-28">
    <div class="max-w-7xl mx-auto px-8">
      <div class="text-center mb-16">
        <span class="uppercase tracking-widest text-sm gold">SIMPLE 3D PLANNER</span>
        <h2 class="section-title serif text-6xl mt-6">Realistic Drag & Rotate 3D Bathroom Planner</h2>
        <p class="text-xl text-zinc-600 mt-6">Click any fixture = select instantly (gold glow + label) • Drag to move • Scroll/buttons to rotate • Click floor to deselect</p>
      </div>

      <div class="grid lg:grid-cols-12 gap-12">
        <div class="lg:col-span-4 space-y-10 bg-white p-8 rounded-3xl border border-gold/30">
          <div>
            <h3 class="text-xl gold font-medium mb-6">Room Size</h3>
            <div class="space-y-6">
              <div><input type="range" id="width" min="3" max="10" step="0.1" value="6" oninput="resizeRoom()" class="w-full accent-gold"></div>
              <div><input type="range" id="depth" min="3" max="8" step="0.1" value="4" oninput="resizeRoom()" class="w-full accent-gold"></div>
            </div>
          </div>

          <div>
            <h3 class="text-xl gold font-medium mb-4">Add Fixtures</h3>
            <div class="grid grid-cols-2 gap-3">
              <button onclick="addFixture('bath')" class="flex items-center gap-3 bg-white border border-gold/30 hover:border-gold p-4 rounded-2xl"><i class="fa-solid fa-bath text-3xl"></i> Bath</button>
              <button onclick="addFixture('shower')" class="flex items-center gap-3 bg-white border border-gold/30 hover:border-gold p-4 rounded-2xl"><i class="fa-solid fa-shower text-3xl"></i> Shower</button>
              <button onclick="addFixture('toilet')" class="flex items-center gap-3 bg-white border border-gold/30 hover:border-gold p-4 rounded-2xl"><i class="fa-solid fa-toilet text-3xl"></i> Toilet</button>
              <button onclick="addFixture('wallhung')" class="flex items-center gap-3 bg-white border border-gold/30 hover:border-gold p-4 rounded-2xl"><i class="fa-solid fa-sink text-3xl"></i> Wall Hung Basin</button>
              <button onclick="addFixture('pedestal')" class="flex items-center gap-3 bg-white border border-gold/30 hover:border-gold p-4 rounded-2xl"><i class="fa-solid fa-sink text-3xl"></i> Pedestal Basin</button>
              <button onclick="addFixture('window')" class="flex items-center gap-3 bg-white border border-gold/30 hover:border-gold p-4 rounded-2xl"><i class="fa-solid fa-window-maximize text-3xl"></i> Window</button>
            </div>
          </div>

          <button onclick="submitDesign()" class="w-full bg-[#d4af37] hover:bg-amber-400 text-black py-7 rounded-3xl text-2xl font-medium">Submit My 3D Design →</button>
        </div>

        <div class="lg:col-span-8">
          <div id="selectedLabel" class="text-center text-gold font-medium h-8 mb-2"></div>
          <canvas id="threeCanvas"></canvas>
          
          <!-- Rotate buttons (desktop + mobile) -->
          <div id="rotatePanel" class="hidden flex justify-center gap-4 mt-4">
            <button onclick="rotateFixture(-0.5)" class="flex items-center gap-2 px-8 py-3 bg-white border-2 border-[#d4af37] hover:bg-[#d4af37] hover:text-black rounded-2xl text-lg font-medium transition-all">⟲ Rotate Left</button>
            <button onclick="rotateFixture(0.5)" class="flex items-center gap-2 px-8 py-3 bg-white border-2 border-[#d4af37] hover:bg-[#d4af37] hover:text-black rounded-2xl text-lg font-medium transition-all">Rotate Right ⟳</button>
          </div>

          <p class="text-center text-sm text-zinc-500 mt-3">Click any fixture to select (gold glow + label) • Drag to move • Scroll or buttons to rotate • Click floor to deselect</p>
        </div>
      </div>
    </div>
  </section>

  <!-- ESTIMATOR, PROCESS, AREAS, FAQ, QUOTE, FLOATING CTA, FOOTER (unchanged) -->
  <section id="estimator" class="py-28 bg-white">
    <div class="max-w-7xl mx-auto px-8">
      <div class="text-center mb-16">
        <span class="uppercase tracking-widest text-sm gold">CALCULATE LIVE</span>
        <h2 class="section-title serif text-6xl">Instant Project Estimator</h2>
      </div>
      <!-- (rest of estimator unchanged) -->
      <div class="grid lg:grid-cols-2 gap-16">
        <div class="space-y-12">
          <div>
            <label class="block text-sm gold mb-3">ROOM SIZE (m²)</label>
            <input type="range" id="sizeSlider" min="4" max="15" value="8" oninput="updateEstimate()" class="w-full accent-gold">
            <div class="flex justify-between text-sm"><span>4 m²</span><span id="sizeValue" class="font-medium">8 m²</span><span>15 m²</span></div>
          </div>
          <div>
            <label class="block text-sm gold mb-3">STYLE</label>
            <div class="flex gap-3">
              <button onclick="setStyle(0)" class="style-btn active px-8 py-4 bg-white border border-gold rounded-2xl">Modern</button>
              <button onclick="setStyle(1)" class="style-btn px-8 py-4 bg-white border border-gold rounded-2xl">Spa</button>
              <button onclick="setStyle(2)" class="style-btn px-8 py-4 bg-white border border-gold rounded-2xl">Classic</button>
            </div>
          </div>
          <div>
            <label class="block text-sm gold mb-4">PREMIUM FEATURES</label>
            <div class="space-y-6">
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" onclick="updateEstimate()" class="accent-gold w-5 h-5">Underfloor heating (+£1,800)</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" onclick="updateEstimate()" class="accent-gold w-5 h-5">Freestanding tub (+£2,400)</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" onclick="updateEstimate()" class="accent-gold w-5 h-5">Smart lighting & mirror (+£1,200)</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" onclick="updateEstimate()" class="accent-gold w-5 h-5">Heated towel rails (+£850)</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" onclick="updateEstimate()" class="accent-gold w-5 h-5">Rainfall shower system (+£1,950)</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" onclick="updateEstimate()" class="accent-gold w-5 h-5">Marble flooring (+£3,200)</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" onclick="updateEstimate()" class="accent-gold w-5 h-5">Built-in storage (+£1,450)</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" onclick="updateEstimate()" class="accent-gold w-5 h-5">Bluetooth speakers (+£650)</label>
            </div>
          </div>
        </div>
        <div class="bg-cream p-12 rounded-3xl border border-gold/30">
          <p class="uppercase text-sm gold tracking-widest">YOUR ESTIMATED PRICE</p>
          <p id="estimatePrice" class="text-7xl font-light text-gold mt-4">£14,750</p>
          <p class="text-sm text-zinc-500 mt-2">Includes full London installation • 10-year guarantee</p>
          <button onclick="saveEstimate()" class="mt-16 w-full bg-[#d4af37] text-black py-8 rounded-3xl text-2xl font-medium">SAVE THIS ESTIMATE & GET FREE 3D</button>
        </div>
      </div>
    </div>
  </section>

  <!-- PROCESS (unchanged) -->
  <section class="py-28 bg-white">
    <div class="max-w-7xl mx-auto px-8">
      <h2 class="text-center text-5xl mb-16">Our 6-Step London Process</h2>
      <div class="grid md:grid-cols-6 gap-8 text-center">
        <div><div class="text-6xl gold mb-4">01</div><p class="font-medium">Free Consultation</p></div>
        <div><div class="text-6xl gold mb-4">02</div><p class="font-medium">Interactive Builder</p></div>
        <div><div class="text-6xl gold mb-4">03</div><p class="font-medium">Material Selection</p></div>
        <div><div class="text-6xl gold mb-4">04</div><p class="font-medium">Final Quote</p></div>
        <div><div class="text-6xl gold mb-4">05</div><p class="font-medium">Expert Installation</p></div>
        <div><div class="text-6xl gold mb-4">06</div><p class="font-medium">Final Handover</p></div>
      </div>
    </div>
  </section>

  <!-- AREAS (unchanged) -->
  <section id="areas" class="py-28 cream">
    <div class="max-w-7xl mx-auto px-8">
      <h2 class="text-center text-5xl mb-12">Serving Every London Postcode</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-6 text-center text-lg">
        <div>Chelsea SW3</div><div>Kensington W8</div><div>Notting Hill W11</div><div>Hampstead NW3</div>
        <div>Islington N1</div><div>Shoreditch EC2</div><div>Belgravia SW1</div><div>Mayfair W1</div>
        <div>Knightsbridge SW1</div><div>Fulham SW6</div><div>Primrose Hill NW1</div><div>Highgate N6</div>
        <div>Clapham SW4</div><div>Wandsworth SW18</div><div>Richmond TW10</div><div>Putney SW15</div>
      </div>
    </div>
  </section>

  <!-- FAQ (unchanged) -->
  <section class="py-28 bg-white">
    <div class="max-w-4xl mx-auto px-8">
      <h2 class="text-center text-5xl mb-16">Frequently Asked Questions</h2>
      <div class="space-y-8">
        <div class="faq-item border-b border-zinc-200 pb-8">
          <div onclick="toggleFAQ(this)" class="flex justify-between cursor-pointer items-center">
            <p class="text-xl">How long does an en-suite installation take?</p>
            <span class="text-3xl text-gold">+</span>
          </div>
          <div class="faq-answer hidden mt-6 text-zinc-600">Most projects take 7-14 days depending on size.</div>
        </div>
        <div class="faq-item border-b border-zinc-200 pb-8">
          <div onclick="toggleFAQ(this)" class="flex justify-between cursor-pointer items-center">
            <p class="text-xl">Can I use the 3D builder myself?</p>
            <span class="text-3xl text-gold">+</span>
          </div>
          <div class="faq-answer hidden mt-6 text-zinc-600">Yes – click fixture to select instantly, drag to move, scroll or buttons to rotate, click floor to deselect.</div>
        </div>
        <div class="faq-item border-b border-zinc-200 pb-8">
          <div onclick="toggleFAQ(this)" class="flex justify-between cursor-pointer items-center">
            <p class="text-xl">Do you work in all London postcodes?</p>
            <span class="text-3xl text-gold">+</span>
          </div>
          <div class="faq-answer hidden mt-6 text-zinc-600">Yes, every postcode in Greater London.</div>
        </div>
        <div class="faq-item border-b border-zinc-200 pb-8">
          <div onclick="toggleFAQ(this)" class="flex justify-between cursor-pointer items-center">
            <p class="text-xl">What is your guarantee?</p>
            <span class="text-3xl text-gold">+</span>
          </div>
          <div class="faq-answer hidden mt-6 text-zinc-600">Full 10-year structural and workmanship guarantee.</div>
        </div>
      </div>
    </div>
  </section>

  <!-- QUOTE FORM (unchanged) -->
  <section id="quote" class="py-28 cream">
    <div class="max-w-2xl mx-auto px-8 text-center">
      <h2 class="text-6xl serif mb-12">Ready for your luxury en-suite?</h2>
      <form id="quoteForm" class="space-y-8">
        <input type="text" placeholder="Full Name" class="w-full bg-white border border-gold/30 p-7 rounded-3xl text-lg" required>
        <input type="tel" placeholder="Phone Number" class="w-full bg-white border border-gold/30 p-7 rounded-3xl text-lg" required>
        <input type="email" placeholder="Email" class="w-full bg-white border border-gold/30 p-7 rounded-3xl text-lg" required>
        <textarea placeholder="Tell us about your project (your realistic 3D design will appear here)" class="w-full bg-white border border-gold/30 p-7 rounded-3xl h-40"></textarea>
        <button type="submit" class="w-full py-8 bg-[#d4af37] text-black text-3xl font-medium rounded-3xl">SEND REQUEST — LONDON TEAM CALLS WITHIN 2 HOURS</button>
      </form>
    </div>
  </section>

  <a href="#quote" class="fixed bottom-8 right-8 bg-[#d4af37] hover:bg-amber-400 text-black px-10 py-5 rounded-3xl shadow-2xl flex items-center gap-3 text-xl font-medium z-50">
    <i class="fa-solid fa-phone-volume"></i> FREE QUOTE
  </a>

  <footer class="py-20 bg-[#fbf7f0] text-center border-t border-gold/30">
    <p class="text-4xl serif tracking-widest gold">EN-SUITE BATHROOMS</p>
    <p class="mt-6 text-zinc-500">Expert Luxury En-Suite Installation Across All London • © 2026</p>
  </footer>

  <script>
    AOS.init({ duration: 1200, once: true });

    // ====================== 3D PLANNER ======================
    let scene, camera, renderer, floorMesh;
    let fixtures3D = [];
    let raycaster = new THREE.Raycaster();
    let mouse = new THREE.Vector2();
    let selectedFixture = null;
    let isDragging = false;
    let roomWidth = 6;
    let roomDepth = 4;

    const whiteMat = new THREE.MeshStandardMaterial({ color: 0xffffff, roughness: 0.25, metalness: 0.05 });
    const chromeMat = new THREE.MeshStandardMaterial({ color: 0xaaaaaa, roughness: 0.2, metalness: 0.9 });

    function init3D() {
      const canvas = document.getElementById('threeCanvas');
      renderer = new THREE.WebGLRenderer({ canvas: canvas, antialias: true });
      renderer.setSize(canvas.clientWidth, canvas.clientHeight);
      renderer.shadowMap.enabled = true;
      renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));

      scene = new THREE.Scene();
      scene.background = new THREE.Color(0xf8f5f0);

      camera = new THREE.PerspectiveCamera(48, canvas.clientWidth / canvas.clientHeight, 0.1, 100);
      camera.position.set(7.8, 6.8, 8.8);
      camera.lookAt(0, 1.2, 0);

      // Lighting
      scene.add(new THREE.AmbientLight(0xffffff, 0.7));
      const hemi = new THREE.HemisphereLight(0xffffff, 0x9ca3af, 0.6);
      scene.add(hemi);
      const dirLight = new THREE.DirectionalLight(0xffffff, 1.15);
      dirLight.position.set(12, 25, 18);
      dirLight.castShadow = true;
      dirLight.shadow.mapSize.width = 2048;
      dirLight.shadow.mapSize.height = 2048;
      scene.add(dirLight);

      createRoom();

      const canvasEl = document.getElementById('threeCanvas');
      // Pointer events (works for mouse + touch on all devices)
      canvasEl.addEventListener('pointerdown', onPointerDown);
      canvasEl.addEventListener('pointermove', onPointerMove);
      canvasEl.addEventListener('pointerup', onPointerUp);
      canvasEl.addEventListener('wheel', onWheel, { passive: false });

      window.addEventListener('resize', () => {
        renderer.setSize(canvas.clientWidth, canvas.clientHeight);
        camera.aspect = canvas.clientWidth / canvas.clientHeight;
        camera.updateProjectionMatrix();
      });

      animate();
    }

    function getFixtureRoot(obj) {
      while (obj && !obj.userData.type) obj = obj.parent;
      return obj && obj.userData.type ? obj : null;
    }

    function createRoom() {
      scene.children = scene.children.filter(c => !c.userData.isRoom);
      const floorGeo = new THREE.PlaneGeometry(roomWidth, roomDepth);
      const floorMat = new THREE.MeshStandardMaterial({ color: 0xe2d9c9, roughness: 0.85 });
      floorMesh = new THREE.Mesh(floorGeo, floorMat);
      floorMesh.rotation.x = -Math.PI / 2;
      floorMesh.receiveShadow = true;
      floorMesh.userData.isRoom = true;
      scene.add(floorMesh);

      const grid = new THREE.GridHelper(Math.max(roomWidth, roomDepth), 20, 0xc4b8a0, 0xc4b8a0);
      grid.userData.isRoom = true;
      scene.add(grid);

      const wallMat = new THREE.MeshStandardMaterial({ color: 0xf5ede1 });
      const backWall = new THREE.Mesh(new THREE.PlaneGeometry(roomWidth, 4.2), wallMat);
      backWall.position.set(0, 2.1, -roomDepth / 2);
      backWall.userData.isRoom = true;
      scene.add(backWall);

      const sideWall = new THREE.Mesh(new THREE.PlaneGeometry(roomDepth, 4.2), wallMat);
      sideWall.rotation.y = Math.PI / 2;
      sideWall.position.set(-roomWidth / 2, 2.1, 0);
      sideWall.userData.isRoom = true;
      scene.add(sideWall);
    }

    function resizeRoom() {
      roomWidth = parseFloat(document.getElementById('width').value);
      roomDepth = parseFloat(document.getElementById('depth').value);
      createRoom();
    }

    function addFixture(type) {
      const group = new THREE.Group();
      group.userData.type = type;

      if (type === 'bath') {
        const tub = new THREE.Mesh(new THREE.BoxGeometry(2.35, 0.72, 1.35), whiteMat);
        tub.position.y = 0.36; tub.castShadow = true;
        group.add(tub);
        const rim = new THREE.Mesh(new THREE.BoxGeometry(2.48, 0.12, 1.48), whiteMat);
        rim.position.y = 0.72;
        group.add(rim);
        const faucet = new THREE.Mesh(new THREE.CylinderGeometry(0.05, 0.05, 0.55, 16), chromeMat);
        faucet.position.set(-0.65, 0.9, 0.55); faucet.rotation.x = Math.PI / 2;
        group.add(faucet);
      } else if (type === 'shower') {
        const tray = new THREE.Mesh(new THREE.BoxGeometry(1.6, 0.15, 1.6), whiteMat);
        tray.position.y = 0.075; group.add(tray);
        const glassMat = new THREE.MeshStandardMaterial({ color: 0xbae6fd, transparent: true, opacity: 0.28 });
        const backG = new THREE.Mesh(new THREE.PlaneGeometry(1.55, 2.3), glassMat);
        backG.position.set(0, 1.2, -0.8); group.add(backG);
        const sideG = new THREE.Mesh(new THREE.PlaneGeometry(1.55, 2.3), glassMat);
        sideG.rotation.y = Math.PI / 2; sideG.position.set(-0.8, 1.2, 0); group.add(sideG);
        const head = new THREE.Mesh(new THREE.CylinderGeometry(0.16, 0.16, 0.1, 32), chromeMat);
        head.position.set(0, 2.35, 0.65); head.rotation.x = Math.PI / 2; group.add(head);
      } else if (type === 'toilet') {
        const bowl = new THREE.Mesh(new THREE.CylinderGeometry(0.36, 0.44, 0.68, 48), whiteMat);
        bowl.position.y = 0.34; group.add(bowl);
        const tank = new THREE.Mesh(new THREE.BoxGeometry(0.66, 0.85, 0.45), whiteMat);
        tank.position.set(0, 0.95, -0.27); group.add(tank);
        const seat = new THREE.Mesh(new THREE.BoxGeometry(0.5, 0.07, 0.58), new THREE.MeshStandardMaterial({ color: 0x1f2937 }));
        seat.position.y = 0.68; group.add(seat);
      } else if (type === 'wallhung') {
        const basin = new THREE.Mesh(new THREE.BoxGeometry(1.0, 0.2, 0.55), whiteMat);
        basin.position.y = 1.05; group.add(basin);
        const support = new THREE.Mesh(new THREE.BoxGeometry(1.0, 0.12, 0.45), chromeMat);
        support.position.y = 0.9; group.add(support);
      } else if (type === 'pedestal') {
        const basin = new THREE.Mesh(new THREE.BoxGeometry(0.95, 0.2, 0.58), whiteMat);
        basin.position.y = 1.1; group.add(basin);
        const ped = new THREE.Mesh(new THREE.CylinderGeometry(0.24, 0.3, 0.82, 32), whiteMat);
        ped.position.y = 0.41; group.add(ped);
      } else if (type === 'window') {
        const frame = new THREE.Mesh(new THREE.BoxGeometry(1.95, 1.6, 0.22), new THREE.MeshStandardMaterial({ color: 0x3f2a1e }));
        frame.position.y = 2.25; group.add(frame);
        const glass = new THREE.Mesh(new THREE.PlaneGeometry(1.7, 1.35), new THREE.MeshStandardMaterial({ color: 0xa5d6ff, side: THREE.DoubleSide }));
        glass.position.set(0, 2.25, 0.12); group.add(glass);
      }

      const margin = 1.1;
      group.position.set(
        (Math.random() - 0.5) * (roomWidth - margin * 2),
        0,
        (Math.random() - 0.5) * (roomDepth - margin * 2)
      );
      if (type === 'window') group.position.y = 1.85;

      scene.add(group);
      fixtures3D.push(group);
    }

    function highlight(fixture, active) {
      if (!fixture) return;
      const scale = active ? 1.085 : 1;
      fixture.scale.set(scale, scale, scale);
      const col = active ? new THREE.Color(0xd4af37) : new THREE.Color(0x000000);
      fixture.traverse(child => {
        if (child.isMesh && child.material) {
          child.material.emissive = col;
        }
      });
    }

    function selectFixture(fixture) {
      if (selectedFixture) highlight(selectedFixture, false);
      selectedFixture = fixture;
      highlight(selectedFixture, true);
      document.getElementById('selectedLabel').innerHTML = `✅ Selected: <span class="capitalize">${fixture.userData.type}</span>`;
      document.getElementById('rotatePanel').classList.remove('hidden');
    }

    function deselect() {
      if (selectedFixture) highlight(selectedFixture, false);
      selectedFixture = null;
      document.getElementById('selectedLabel').innerHTML = '';
      document.getElementById('rotatePanel').classList.add('hidden');
    }

    function onPointerDown(e) {
      const canvas = document.getElementById('threeCanvas');
      const rect = canvas.getBoundingClientRect();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;

      mouse.x = ((clientX - rect.left) / rect.width) * 2 - 1;
      mouse.y = -((clientY - rect.top) / rect.height) * 2 + 1;

      raycaster.setFromCamera(mouse, camera);

      const fixtureHits = raycaster.intersectObjects(fixtures3D, true);
      if (fixtureHits.length > 0) {
        const hitGroup = getFixtureRoot(fixtureHits[0].object);
        if (hitGroup) {
          if (selectedFixture !== hitGroup) selectFixture(hitGroup);
          isDragging = true;
          return;
        }
      }

      // Clicked empty / floor → deselect
      deselect();
      isDragging = false;
    }

    function onPointerMove(e) {
      if (!isDragging || !selectedFixture) return;
      const canvas = document.getElementById('threeCanvas');
      const rect = canvas.getBoundingClientRect();
      const clientX = e.touches ? e.touches[0].clientX : e.clientX;
      const clientY = e.touches ? e.touches[0].clientY : e.clientY;

      mouse.x = ((clientX - rect.left) / rect.width) * 2 - 1;
      mouse.y = -((clientY - rect.top) / rect.height) * 2 + 1;

      raycaster.setFromCamera(mouse, camera);
      const floorHit = raycaster.intersectObject(floorMesh);
      if (floorHit.length > 0) {
        let x = Math.max(-roomWidth / 2 + 0.8, Math.min(roomWidth / 2 - 0.8, floorHit[0].point.x));
        let z = Math.max(-roomDepth / 2 + 0.8, Math.min(roomDepth / 2 - 0.8, floorHit[0].point.z));
        selectedFixture.position.set(x, selectedFixture.position.y, z);
      }
    }

    function onPointerUp() {
      isDragging = false;
    }

    function onWheel(e) {
      if (selectedFixture) {
        selectedFixture.rotation.y += e.deltaY * 0.006;
        e.preventDefault();
      }
    }

    function rotateFixture(delta) {
      if (selectedFixture) selectedFixture.rotation.y += delta;
    }

    function animate() {
      requestAnimationFrame(animate);
      renderer.render(scene, camera);
    }

    function submitDesign() {
      let summary = "MY REALISTIC 3D DESIGN:\n";
      fixtures3D.forEach(f => {
        summary += `• ${f.userData.type.toUpperCase()} at (${f.position.x.toFixed(1)}, ${f.position.z.toFixed(1)}) rotated ${f.rotation.y.toFixed(1)}\n`;
      });
      const textarea = document.querySelector('#quoteForm textarea');
      if (textarea) textarea.value = summary + "\nReady for this exact luxury layout!";
      document.getElementById('quote').scrollIntoView({ behavior: 'smooth' });
      alert("✅ Design submitted – our London team will call you!");
    }

    // ====================== OTHER FUNCTIONS (unchanged) ======================
    let basePrice = 9800;
    function updateEstimate() {
      const size = parseInt(document.getElementById('sizeSlider').value);
      let price = basePrice + (size * 850);
      document.querySelectorAll('#estimator input[type="checkbox"]:checked').forEach(c => {
        const match = c.parentElement.textContent.match(/\d+/);
        if (match) price += parseInt(match[0]) * 1000;
      });
      document.getElementById('estimatePrice').textContent = '£' + price.toLocaleString();
      document.getElementById('sizeValue').textContent = size + ' m²';
    }
    function setStyle(n) {
      document.querySelectorAll('.style-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.style-btn')[n].classList.add('active');
      updateEstimate();
    }
    function saveEstimate() { alert("Estimate saved!"); }
    function toggleFAQ(el) {
      const answer = el.nextElementSibling;
      answer.classList.toggle('hidden');
      const sign = el.querySelector('span');
      sign.textContent = sign.textContent === '+' ? '−' : '+';
    }
    document.getElementById('quoteForm').addEventListener('submit', (e) => {
      e.preventDefault();
      alert("Thank you! Our London team will call you within 2 hours.");
    });
    function closeRoomioBanner() {
      const b = document.getElementById('roomioBanner');
      b.style.opacity = '0';
      setTimeout(() => b.style.display = 'none', 600);
      localStorage.setItem('roomioBannerClosed', 'true');
    }

    window.onload = () => {
      init3D();
      updateEstimate();
      if (localStorage.getItem('roomioBannerClosed') === 'true') document.getElementById('roomioBanner').style.display = 'none';
    };
  </script>
</body>
</html>
