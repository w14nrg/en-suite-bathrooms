<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Luxury en-suite bathroom installation London. Free full-screen professional 2D planner with realistic rotatable fixtures. Expert fitters Chelsea, Kensington, Notting Hill. 10-year guarantee.">
  <title>En-Suite Bathrooms | Professional 2D Planner â€¢ Luxury London</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <link rel="stylesheet" href="https://unpkg.com/aos@2.3.1/dist/aos.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@300;400;700&family=Inter:wght@300;400;500&display=swap');
    body { font-family: 'Inter', sans-serif; }
    .serif { font-family: 'Playfair Display', serif; }
    .nav { background: rgba(255,255,255,0.98); backdrop-filter: blur(20px); }
    .gold { color: #d4af37; }
    .cream { background-color: #fbf7f0; }
    .section-title { font-size: 3.8rem; line-height: 1.05; font-weight: 300; letter-spacing: -3px; }

    .hero-video { position: absolute; inset: 0; width: 100%; height: 100%; object-fit: cover; z-index: 0; }
    .hero-overlay { position: absolute; inset: 0; background: linear-gradient(to bottom, rgba(0,0,0,0.25), rgba(0,0,0,0.5)); z-index: 1; }

    .water-stream { position: absolute; top: 38%; left: 48%; width: 4px; height: 180px; background: linear-gradient(transparent, #a5f3fc, #67e8f9); animation: waterFlow 0.8s linear infinite; opacity: 0.85; z-index: 5; }
    .bubbles { position: absolute; bottom: 0; left: 0; width: 100%; height: 60%; overflow: hidden; pointer-events: none; z-index: 6; }
    .bubble { position: absolute; bottom: -50px; background: rgba(255,255,255,0.75); border-radius: 50%; animation: bubbleRise linear infinite; }
    @keyframes bubbleRise { to { transform: translateY(-800px); opacity: 0; } }
    .steam { position: absolute; bottom: 25%; left: 50%; transform: translateX(-50%); pointer-events: none; z-index: 7; }
    .steam-particle { position: absolute; width: 10px; height: 10px; background: rgba(255,255,255,0.8); border-radius: 50%; animation: steamRise 4s infinite linear; }
    @keyframes steamRise { 0% { transform: translateY(0) scale(1); opacity: 0.9; } 100% { transform: translateY(-280px) scale(0.2); opacity: 0; } }

    #roomioBanner { animation: bannerFlash 1.6s infinite alternate ease-in-out; }
    @keyframes bannerFlash { from { box-shadow: 0 0 25px rgba(212,175,55,0.6); } to { box-shadow: 0 0 70px rgba(212,175,55,1); } }
  </style>
</head>
<body class="bg-[#fbf7f0] text-zinc-900">

  <!-- NAVBAR -->
  <nav class="nav fixed top-0 w-full z-50 border-b border-[#d4af37]/30 py-7">
    <div class="max-w-7xl mx-auto px-8 flex justify-between items-center">
      <div class="flex items-center gap-4">
        <i class="fa-solid fa-bath text-5xl gold"></i>
        <span class="text-4xl serif tracking-widest font-light">EN-SUITE</span>
      </div>
      <div class="hidden md:flex gap-10 text-lg font-light">
        <a href="#builder" class="hover:gold transition">2D Planner</a>
        <a href="#estimator" class="hover:gold transition">Instant Estimator</a>
        <a href="#areas" class="hover:gold transition">Areas</a>
        <a href="#quote" class="hover:gold transition">Contact</a>
      </div>
      <a href="#quote" class="bg-[#d4af37] hover:bg-amber-400 text-black font-medium px-10 py-4 rounded-full transition">BOOK FREE QUOTE</a>
    </div>
  </nav>

  <!-- HERO -->
  <header class="relative h-screen overflow-hidden flex items-center">
    <video autoplay loop muted playsinline class="hero-video">
      <source src="https://videos.pexels.com/video-files/6702578/6702578-uhd_2560_1440_25fps.mp4" type="video/mp4">
    </video>
    <div class="hero-overlay"></div>

    <div class="water-stream"></div>
    <div class="bubbles">
      <div class="bubble" style="left:22%; width:18px; height:18px; animation-duration:4.8s; animation-delay:0s"></div>
      <div class="bubble" style="left:35%; width:12px; height:12px; animation-duration:6.2s; animation-delay:0.5s"></div>
      <div class="bubble" style="left:48%; width:25px; height:25px; animation-duration:5.1s; animation-delay:1.2s"></div>
      <div class="bubble" style="left:61%; width:15px; height:15px; animation-duration:7s; animation-delay:0.3s"></div>
      <div class="bubble" style="left:74%; width:20px; height:20px; animation-duration:4.5s; animation-delay:1.8s"></div>
    </div>
    <div class="steam">
      <div class="steam-particle" style="left:-40px; animation-delay:0s"></div>
      <div class="steam-particle" style="left:-20px; animation-delay:0.6s"></div>
      <div class="steam-particle" style="left:10px; animation-delay:1.2s"></div>
      <div class="steam-particle" style="left:35px; animation-delay:0.4s"></div>
      <div class="steam-particle" style="left:60px; animation-delay:1.8s"></div>
    </div>

    <div class="max-w-6xl mx-auto px-8 text-white text-center z-10 relative">
      <h1 class="section-title text-7xl md:text-[5.8rem] serif leading-none mb-8" data-aos="fade-up">LONDON'S MOST LAVISH ENSUITES</h1>
      <p class="text-3xl max-w-3xl mx-auto mb-12" data-aos="fade-up" data-aos-delay="300">Free professional full-screen 2D planner</p>
      <a href="#builder" class="inline-block bg-white text-black px-16 py-7 rounded-3xl text-2xl font-medium hover:scale-105 transition">START YOUR FLOOR PLAN NOW</a>
    </div>

    <div id="roomioBanner" class="fixed bottom-0 left-0 right-0 bg-gradient-to-r from-black via-zinc-950 to-black py-6 z-[9999] border-t-4 border-[#d4af37]">
      <div class="max-w-7xl mx-auto px-8 flex items-center justify-between text-white w-full">
        <span class="text-xl md:text-2xl serif tracking-wider text-[#d4af37]">en-suite not enough?</span>
        <span class="hidden md:block text-xl">turn your spare room into a studio apartment</span>
        <a href="https://www.roomio.studio" target="_blank" class="bg-[#d4af37] hover:bg-amber-400 text-black px-9 py-4 rounded-full font-semibold text-lg transition-all hover:scale-105">click here â†’</a>
        <button onclick="closeRoomioBanner()" class="text-5xl text-[#d4af37] hover:text-white ml-8 leading-none">Ã—</button>
      </div>
    </div>
  </header>

  <!-- BUILDER -->
  <section id="builder" class="cream py-28">
    <div class="max-w-7xl mx-auto px-8 text-center">
      <span class="uppercase tracking-widest text-sm gold">PROFESSIONAL 2D PLANNER</span>
      <h2 class="section-title serif text-6xl mt-6">Architect-Grade Full-Screen Bathroom Designer</h2>
      <p class="text-xl text-zinc-600 max-w-2xl mx-auto mt-6">Realistic rotatable fixtures â€¢ Thin walls & pipes â€¢ Drag â€¢ Scroll to rotate â€¢ Scroll when nothing selected to zoom â€¢ Shift + Wheel on fixture to resize</p>
      
      <div class="mt-16 bg-white rounded-3xl p-16 max-w-3xl mx-auto border border-gold/30">
        <button onclick="launchPlanner()" 
                class="mt-8 bg-[#d4af37] hover:bg-amber-400 text-black px-20 py-8 rounded-3xl text-3xl font-medium transition-all active:scale-95">
          LAUNCH PROFESSIONAL 2D PLANNER â†’
        </button>
      </div>
    </div>
  </section>

  <!-- ESTIMATOR -->
  <section id="estimator" class="py-28 bg-white">
    <div class="max-w-7xl mx-auto px-8">
      <div class="text-center mb-16">
        <span class="uppercase tracking-widest text-sm gold">CALCULATE LIVE</span>
        <h2 class="section-title serif text-6xl">Instant Project Estimator</h2>
      </div>
      <div class="grid lg:grid-cols-2 gap-16">
        <div class="space-y-12">
          <div>
            <label class="block text-sm gold mb-3">ROOM SIZE (mÂ²)</label>
            <input type="range" id="sizeSlider" min="4" max="15" value="8" oninput="updateEstimate()" class="w-full accent-gold">
            <div class="flex justify-between text-sm"><span>4 mÂ²</span><span id="sizeValue" class="font-medium">8 mÂ²</span><span>15 mÂ²</span></div>
          </div>
          <div>
            <label class="block text-sm gold mb-3">STYLE</label>
            <div class="flex gap-3">
              <button onclick="setStyle(0)" class="style-btn active px-8 py-4 bg-white border border-gold rounded-2xl">Modern</button>
              <button onclick="setStyle(1)" class="style-btn px-8 py-4 bg-white border border-gold rounded-2xl">Spa</button>
              <button onclick="setStyle(2)" class="style-btn px-8 py-4 bg-white border border-gold rounded-2xl">Classic</button>
            </div>
          </div>
          <div>
            <label class="block text-sm gold mb-4">PREMIUM FEATURES</label>
            <div class="space-y-6">
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" onclick="updateEstimate()" class="accent-gold w-5 h-5">Underfloor heating (+Â£1,800)</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" onclick="updateEstimate()" class="accent-gold w-5 h-5">Freestanding tub (+Â£2,400)</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" onclick="updateEstimate()" class="accent-gold w-5 h-5">Smart lighting & mirror (+Â£1,200)</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" onclick="updateEstimate()" class="accent-gold w-5 h-5">Heated towel rails (+Â£850)</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" onclick="updateEstimate()" class="accent-gold w-5 h-5">Rainfall shower system (+Â£1,950)</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" onclick="updateEstimate()" class="accent-gold w-5 h-5">Marble flooring (+Â£3,200)</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" onclick="updateEstimate()" class="accent-gold w-5 h-5">Built-in storage (+Â£1,450)</label>
              <label class="flex items-center gap-3 cursor-pointer"><input type="checkbox" onclick="updateEstimate()" class="accent-gold w-5 h-5">Bluetooth speakers (+Â£650)</label>
            </div>
          </div>
        </div>
        <div class="bg-cream p-12 rounded-3xl border border-gold/30">
          <p class="uppercase text-sm gold tracking-widest">YOUR ESTIMATED PRICE</p>
          <p id="estimatePrice" class="text-7xl font-light text-gold mt-4">Â£14,750</p>
          <p class="text-sm text-zinc-500 mt-2">Includes full London installation â€¢ 10-year guarantee</p>
          <button onclick="saveEstimate()" class="mt-16 w-full bg-[#d4af37] text-black py-8 rounded-3xl text-2xl font-medium">SAVE THIS ESTIMATE & GET FREE DESIGN</button>
        </div>
      </div>
    </div>
  </section>

  <!-- PROCESS -->
  <section class="py-28 bg-white">
    <div class="max-w-7xl mx-auto px-8">
      <h2 class="text-center text-5xl mb-16">Our 6-Step London Process</h2>
      <div class="grid md:grid-cols-6 gap-8 text-center">
        <div><div class="text-6xl gold mb-4">01</div><p class="font-medium">Free Consultation</p></div>
        <div><div class="text-6xl gold mb-4">02</div><p class="font-medium">2D Planner</p></div>
        <div><div class="text-6xl gold mb-4">03</div><p class="font-medium">Material Selection</p></div>
        <div><div class="text-6xl gold mb-4">04</div><p class="font-medium">Final Quote</p></div>
        <div><div class="text-6xl gold mb-4">05</div><p class="font-medium">Expert Installation</p></div>
        <div><div class="text-6xl gold mb-4">06</div><p class="font-medium">Final Handover</p></div>
      </div>
    </div>
  </section>

  <!-- AREAS -->
  <section id="areas" class="py-28 cream">
    <div class="max-w-7xl mx-auto px-8">
      <h2 class="text-center text-5xl mb-12">Serving Every London Postcode</h2>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-6 text-center text-lg">
        <div>Chelsea SW3</div><div>Kensington W8</div><div>Notting Hill W11</div><div>Hampstead NW3</div>
        <div>Islington N1</div><div>Shoreditch EC2</div><div>Belgravia SW1</div><div>Mayfair W1</div>
        <div>Knightsbridge SW1</div><div>Fulham SW6</div><div>Primrose Hill NW1</div><div>Highgate N6</div>
        <div>Clapham SW4</div><div>Wandsworth SW18</div><div>Richmond TW10</div><div>Putney SW15</div>
      </div>
    </div>
  </section>

  <!-- FAQ -->
  <section class="py-28 bg-white">
    <div class="max-w-4xl mx-auto px-8">
      <h2 class="text-center text-5xl mb-16">Frequently Asked Questions</h2>
      <div class="space-y-8">
        <div class="faq-item border-b border-zinc-200 pb-8">
          <div onclick="toggleFAQ(this)" class="flex justify-between cursor-pointer items-center">
            <p class="text-xl">How long does an en-suite installation take?</p>
            <span class="text-3xl text-gold">+</span>
          </div>
          <div class="faq-answer hidden mt-6 text-zinc-600">Most projects take 7-14 days depending on size.</div>
        </div>
        <div class="faq-item border-b border-zinc-200 pb-8">
          <div onclick="toggleFAQ(this)" class="flex justify-between cursor-pointer items-center">
            <p class="text-xl">Can I use the professional 2D planner?</p>
            <span class="text-3xl text-gold">+</span>
          </div>
          <div class="faq-answer hidden mt-6 text-zinc-600">Yes â€“ click to select, drag to move, mouse wheel to rotate, Shift + wheel to resize, scroll when nothing selected to zoom.</div>
        </div>
        <div class="faq-item border-b border-zinc-200 pb-8">
          <div onclick="toggleFAQ(this)" class="flex justify-between cursor-pointer items-center">
            <p class="text-xl">Do you work in all London postcodes?</p>
            <span class="text-3xl text-gold">+</span>
          </div>
          <div class="faq-answer hidden mt-6 text-zinc-600">Yes, every postcode in Greater London.</div>
        </div>
        <div class="faq-item border-b border-zinc-200 pb-8">
          <div onclick="toggleFAQ(this)" class="flex justify-between cursor-pointer items-center">
            <p class="text-xl">What is your guarantee?</p>
            <span class="text-3xl text-gold">+</span>
          </div>
          <div class="faq-answer hidden mt-6 text-zinc-600">Full 10-year structural and workmanship guarantee.</div>
        </div>
      </div>
    </div>
  </section>

  <!-- QUOTE -->
  <section id="quote" class="py-28 cream">
    <div class="max-w-2xl mx-auto px-8 text-center">
      <h2 class="text-6xl serif mb-12">Ready for your luxury en-suite?</h2>
      <form id="quoteForm" class="space-y-8">
        <input type="text" placeholder="Full Name" class="w-full bg-white border border-gold/30 p-7 rounded-3xl text-lg" required>
        <input type="tel" placeholder="Phone Number" class="w-full bg-white border border-gold/30 p-7 rounded-3xl text-lg" required>
        <input type="email" placeholder="Email" class="w-full bg-white border border-gold/30 p-7 rounded-3xl text-lg" required>
        <textarea id="quoteTextarea" placeholder="Tell us about your project (your professional 2D layout will appear here)" class="w-full bg-white border border-gold/30 p-7 rounded-3xl h-40"></textarea>
        <button type="submit" class="w-full py-8 bg-[#d4af37] text-black text-3xl font-medium rounded-3xl">SEND REQUEST â€” LONDON TEAM CALLS WITHIN 2 HOURS</button>
      </form>
    </div>
  </section>

  <!-- FLOATING CTA -->
  <a href="#quote" class="fixed bottom-8 right-8 bg-[#d4af37] hover:bg-amber-400 text-black px-10 py-5 rounded-3xl shadow-2xl flex items-center gap-3 text-xl font-medium z-50">
    <i class="fa-solid fa-phone-volume"></i> FREE QUOTE
  </a>

  <!-- FOOTER -->
  <footer class="py-20 bg-[#fbf7f0] text-center border-t border-gold/30">
    <p class="text-4xl serif tracking-widest gold">EN-SUITE BATHROOMS</p>
    <p class="mt-6 text-zinc-500">Expert Luxury En-Suite Installation Across All London â€¢ Â© 2026</p>
  </footer>

  <!-- FULL-SCREEN 2D PLANNER MODAL -->
  <div id="plannerModal" class="hidden fixed inset-0 bg-zinc-950 z-[99999] flex flex-col">
    <!-- Top bar -->
    <div class="bg-black py-5 px-8 flex items-center justify-between border-b border-zinc-800 text-white">
      <div class="flex items-center gap-4">
        <i class="fa-solid fa-bath text-4xl gold"></i>
        <span class="serif text-3xl tracking-wider">PROFESSIONAL 2D PLANNER</span>
      </div>
      <button onclick="exitPlanner()" class="text-4xl hover:text-gold">âœ•</button>
    </div>

    <!-- Toolbar -->
    <div class="bg-zinc-900 py-4 px-8 flex items-center gap-3 border-b border-zinc-800 text-white text-sm overflow-x-auto">
      <button onclick="setTool('select')" id="btn-select" class="tool-btn active px-6 py-3 rounded-2xl hover:bg-zinc-800 flex items-center gap-2">Select / Move</button>
      <button onclick="setTool('wall')" id="btn-wall" class="tool-btn px-6 py-3 rounded-2xl hover:bg-zinc-800 flex items-center gap-2">ðŸ§± Wall (thin)</button>
      <button onclick="setTool('hot')" id="btn-hot" class="tool-btn px-6 py-3 rounded-2xl hover:bg-zinc-800 flex items-center gap-2 text-red-400">ðŸ”´ Hot Pipe</button>
      <button onclick="setTool('cold')" id="btn-cold" class="tool-btn px-6 py-3 rounded-2xl hover:bg-zinc-800 flex items-center gap-2 text-blue-400">ðŸ”µ Cold Pipe</button>
      <button onclick="setTool('drain')" id="btn-drain" class="tool-btn px-6 py-3 rounded-2xl hover:bg-zinc-800 flex items-center gap-2">âš« Drainage</button>
      <button onclick="setTool('erase')" id="btn-erase" class="tool-btn px-6 py-3 rounded-2xl hover:bg-zinc-800 flex items-center gap-2 text-red-500">Erase</button>
      
      <div class="ml-auto">
        <select onchange="addFixtureFromDropdown(this)" class="bg-zinc-800 border border-gold text-white px-8 py-3 rounded-3xl text-base">
          <option value="">Add Fixture...</option>
          <optgroup label="Sanitary">
            <option value="toilet">Toilet</option>
            <option value="alcove-bath">Normal Alcove Bath</option>
            <option value="freestanding-bath">Freestanding Bath</option>
            <option value="shower">Shower Enclosure</option>
            <option value="wallhung">Wall Hung Basin</option>
            <option value="pedestal">Pedestal Basin</option>
            <option value="bidet">Bidet</option>
          </optgroup>
          <optgroup label="Heating & Furniture">
            <option value="towel-radiator">Towel Radiator</option>
            <option value="vanity">Vanity Unit</option>
            <option value="led-mirror">LED Mirror</option>
          </optgroup>
          <optgroup label="External">
            <option value="manhole">Manhole (Drain)</option>
            <option value="grass">Grass Area</option>
            <option value="door">Door</option>
            <option value="window">Window</option>
          </optgroup>
        </select>
      </div>
    </div>

    <div class="flex flex-1 overflow-hidden">
      <canvas id="fullCanvas" class="flex-1 bg-[#f8f1e3]"></canvas>
      <div class="w-80 bg-zinc-900 text-white p-8 overflow-auto">
        <h3 class="gold text-xl mb-6">Selected</h3>
        <div id="infoPanel" class="text-zinc-400">Click fixture/pipe to select â€¢ Drag to move â€¢ Wheel to rotate â€¢ Shift + Wheel to resize</div>
      </div>
    </div>
  </div>

  <script>
    AOS.init({ duration: 1200, once: true });

    function closeRoomioBanner() {
      const b = document.getElementById('roomioBanner');
      if (!b) return;
      b.style.transition = 'opacity 0.4s ease';
      b.style.opacity = '0';
      setTimeout(() => { b.style.display = 'none'; }, 500);
      localStorage.setItem('roomioBannerClosed', 'true');
    }

    // ====================== PROFESSIONAL 2D PLANNER ======================
    let canvas, ctx;
    let scale = 58, offsetX = 90, offsetY = 70;
    let currentTool = 'select';
    let fixtures = [], walls = [], pipes = [];
    let selectedItem = null;
    let selectedPipeIndex = -1;
    let isDragging = false, dragOffsetX = 0, dragOffsetY = 0, drawingStart = null;

    function launchPlanner() {
      const modal = document.getElementById('plannerModal');
      modal.classList.remove('hidden');
      setTimeout(() => initPlannerCanvas(), 50);
    }

    function initPlannerCanvas() {
      canvas = document.getElementById('fullCanvas');
      ctx = canvas.getContext('2d');

      const resize = () => {
        canvas.width = window.innerWidth - 330;
        canvas.height = window.innerHeight - 180;
        draw();
      };
      resize();
      window.addEventListener('resize', resize);

      canvas.addEventListener('mousedown', onMouseDown);
      canvas.addEventListener('mousemove', onMouseMove);
      canvas.addEventListener('mouseup', onMouseUp);
      canvas.addEventListener('wheel', onWheel);
    }

    function drawFixture(f) {
      const px = offsetX + f.x * scale;
      const py = offsetY + f.y * scale;
      const s = scale * 0.62 * (f.scale || 1);

      ctx.save();
      ctx.translate(px, py);
      ctx.rotate(f.rotation || 0);

      ctx.shadowColor = 'rgba(0,0,0,0.4)';
      ctx.shadowBlur = 20;
      ctx.shadowOffsetX = 8;
      ctx.shadowOffsetY = 12;

      if (f.type === 'toilet') {
        // Tank
        ctx.fillStyle = '#f1f5f9';
        ctx.fillRect(-s*0.75, -s*1.2, s*1.5, s*0.6);
        ctx.strokeStyle = '#334155';
        ctx.lineWidth = 5;
        ctx.strokeRect(-s*0.75, -s*1.2, s*1.5, s*0.6);
        // Lid
        ctx.fillStyle = '#e2e8f0';
        ctx.fillRect(-s*0.78, -s*1.35, s*1.56, s*0.2);
        // Bowl
        ctx.fillStyle = '#f1f5f9';
        ctx.beginPath();
        ctx.ellipse(0, s*0.4, s*0.75, s*0.62, 0, 0, Math.PI*2);
        ctx.fill();
        ctx.stroke();
        // Base
        ctx.fillStyle = '#e2e8f0';
        ctx.fillRect(-s*0.6, s*0.8, s*1.2, s*0.25);
        // Seat
        ctx.fillStyle = '#1e2937';
        ctx.fillRect(-s*0.55, s*0.22, s*1.1, s*0.2);
      } else if (f.type === 'alcove-bath') {
        // Normal alcove bath
        ctx.fillStyle = '#e0f2fe';
        ctx.fillRect(-s*1.4, -s*0.4, s*2.8, s*0.9);
        ctx.strokeStyle = '#334155';
        ctx.lineWidth = 8;
        ctx.strokeRect(-s*1.4, -s*0.4, s*2.8, s*0.9);
        // Inner
        ctx.fillStyle = '#bae6fd';
        ctx.fillRect(-s*1.3, -s*0.3, s*2.6, s*0.7);
        // Rim
        ctx.strokeStyle = '#64748b';
        ctx.lineWidth = 4;
        ctx.strokeRect(-s*1.4, -s*0.4, s*2.8, s*0.9);
        // Taps
        ctx.fillStyle = '#64748b';
        ctx.fillRect(s*0.9, -s*0.5, s*0.25, s*0.32);
      } else if (f.type === 'freestanding-bath') {
        ctx.fillStyle = '#e0f2fe';
        ctx.beginPath();
        ctx.ellipse(0, s*0.15, s*1.5, s*0.7, 0, 0, Math.PI*2);
        ctx.fill();
        ctx.strokeStyle = '#334155';
        ctx.lineWidth = 8;
        ctx.stroke();
        ctx.strokeStyle = '#64748b';
        ctx.lineWidth = 4;
        ctx.beginPath();
        ctx.ellipse(0, s*0.1, s*1.55, s*0.65, 0, 0, Math.PI*2);
        ctx.stroke();
        ctx.fillStyle = '#475569';
        ctx.fillRect(-s*1.1, s*0.55, s*0.22, s*0.45);
        ctx.fillRect(s*0.88, s*0.55, s*0.22, s*0.45);
      } else if (f.type === 'shower') {
        ctx.fillStyle = '#bae6fd';
        ctx.globalAlpha = 0.28;
        ctx.fillRect(-s*0.95, -s*1.15, s*1.9, s*2.1);
        ctx.globalAlpha = 1;
        ctx.fillStyle = '#e0f2fe';
        ctx.fillRect(-s*0.95, s*0.85, s*1.9, s*0.25);
        ctx.strokeStyle = '#334155';
        ctx.lineWidth = 5;
        ctx.strokeRect(-s*0.95, -s*1.15, s*1.9, s*2.1);
        ctx.lineWidth = 3;
        ctx.beginPath(); ctx.moveTo(-s*0.3, -s*1.15); ctx.lineTo(-s*0.3, s*0.85); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(s*0.3, -s*1.15); ctx.lineTo(s*0.3, s*0.85); ctx.stroke();
        ctx.fillStyle = '#475569';
        ctx.fillRect(-s*0.15, -s*1.25, s*0.3, s*0.12);
      } else if (f.type === 'towel-radiator') {
        ctx.fillStyle = '#cbd5e1';
        ctx.fillRect(-s*0.45, -s*1.25, s*0.9, s*2.5);
        ctx.strokeStyle = '#475569';
        ctx.lineWidth = 6;
        for (let i = 0; i < 8; i++) {
          ctx.beginPath();
          ctx.moveTo(-s*0.35, -s*1.1 + i * (s*0.32));
          ctx.lineTo(s*0.35, -s*1.1 + i * (s*0.32));
          ctx.stroke();
        }
      } else if (f.type === 'manhole') {
        ctx.fillStyle = '#1e2937';
        ctx.beginPath(); ctx.arc(0, 0, s*0.95, 0, Math.PI*2); ctx.fill();
        ctx.strokeStyle = '#64748b';
        ctx.lineWidth = 7;
        ctx.beginPath(); ctx.moveTo(-s*0.6, 0); ctx.lineTo(s*0.6, 0); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(0, -s*0.6); ctx.lineTo(0, s*0.6); ctx.stroke();
        ctx.fillStyle = '#cbd5e1';
        ctx.font = 'bold 18px sans-serif';
        ctx.fillText('MH', 0, 6);
      } else if (f.type === 'grass') {
        ctx.fillStyle = '#4ade80';
        ctx.fillRect(-s*2, -s*0.9, s*4, s*1.8);
        ctx.strokeStyle = '#16a34a';
        ctx.lineWidth = 3;
        for (let i = -s*1.8; i < s*1.9; i += s*0.25) {
          ctx.beginPath();
          ctx.moveTo(i, -s*0.9);
          ctx.lineTo(i + s*0.22, s*0.8);
          ctx.stroke();
        }
      } else if (f.type === 'door') {
        ctx.fillStyle = '#78350f';
        ctx.fillRect(-s*0.25, -s*1.25, s*0.5, s*2.5);
        ctx.fillStyle = '#ca8a04';
        ctx.fillRect(s*0.12, 0, s*0.1, s*0.1);
        ctx.strokeStyle = '#451a03';
        ctx.lineWidth = 6;
        ctx.beginPath(); ctx.arc(0, 0, s*1.15, Math.PI*1.5, Math.PI*0.5); ctx.stroke();
      } else if (f.type === 'window') {
        ctx.fillStyle = '#bae6fd';
        ctx.fillRect(-s*1.15, -s*0.95, s*2.3, s*1.7);
        ctx.strokeStyle = '#78350f';
        ctx.lineWidth = 7;
        ctx.strokeRect(-s*1.15, -s*0.95, s*2.3, s*1.7);
        ctx.beginPath(); ctx.moveTo(0, -s*0.95); ctx.lineTo(0, s*0.75); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(-s*1.15, 0); ctx.lineTo(s*1.15, 0); ctx.stroke();
      } else if (f.type === 'wallhung') {
        ctx.fillStyle = '#f1f5f9';
        ctx.fillRect(-s*0.9, -s*0.3, s*1.8, s*0.5);
        ctx.strokeStyle = '#334155';
        ctx.lineWidth = 5;
        ctx.strokeRect(-s*0.9, -s*0.3, s*1.8, s*0.5);
        ctx.fillStyle = '#64748b';
        ctx.fillRect(-s*0.8, s*0.15, s*0.2, s*0.4);
      } else if (f.type === 'pedestal') {
        ctx.fillStyle = '#f1f5f9';
        ctx.fillRect(-s*0.9, -s*0.3, s*1.8, s*0.5);
        ctx.strokeStyle = '#334155';
        ctx.lineWidth = 5;
        ctx.strokeRect(-s*0.9, -s*0.3, s*1.8, s*0.5);
        ctx.fillStyle = '#f1f5f9';
        ctx.beginPath();
        ctx.ellipse(0, s*0.6, s*0.45, s*0.25, 0, 0, Math.PI*2);
        ctx.fill();
      } else if (f.type === 'bidet') {
        ctx.fillStyle = '#f1f5f9';
        ctx.fillRect(-s*0.6, -s*0.2, s*1.2, s*0.5);
        ctx.strokeStyle = '#334155';
        ctx.lineWidth = 5;
        ctx.strokeRect(-s*0.6, -s*0.2, s*1.2, s*0.5);
      } else if (f.type === 'vanity') {
        ctx.fillStyle = '#78350f';
        ctx.fillRect(-s*1.1, -s*0.4, s*2.2, s*0.8);
        ctx.fillStyle = '#f1f5f9';
        ctx.fillRect(-s*1.0, -s*0.8, s*2.0, s*0.5);
      } else if (f.type === 'led-mirror') {
        ctx.fillStyle = '#1e2937';
        ctx.fillRect(-s*0.9, -s*0.9, s*1.8, s*1.2);
        ctx.fillStyle = '#bae6fd';
        ctx.fillRect(-s*0.8, -s*0.8, s*1.6, s*1.0);
      } else {
        ctx.fillStyle = '#e2e8f0';
        ctx.fillRect(-s*0.85, -s*0.85, s*1.7, s*1.7);
      }
      ctx.restore();
    }

    function draw() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);

      // Grid
      ctx.strokeStyle = '#e5d9c8';
      ctx.lineWidth = 1;
      for (let x = offsetX % (scale * 0.25); x < canvas.width; x += scale * 0.25) {
        ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, canvas.height); ctx.stroke();
      }
      for (let y = offsetY % (scale * 0.25); y < canvas.height; y += scale * 0.25) {
        ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(canvas.width, y); ctx.stroke();
      }

      // Walls â€“ thinner
      ctx.strokeStyle = '#3f2a1e';
      ctx.lineWidth = 9;
      walls.forEach(w => {
        ctx.beginPath();
        ctx.moveTo(offsetX + w.x1 * scale, offsetY + w.y1 * scale);
        ctx.lineTo(offsetX + w.x2 * scale, offsetY + w.y2 * scale);
        ctx.stroke();
      });

      // Pipes â€“ thinner
      pipes.forEach((p, i) => {
        const isSel = (selectedPipeIndex === i);
        ctx.strokeStyle = p.type === 'hot' ? '#ef4444' : p.type === 'cold' ? '#3b82f6' : '#111827';
        ctx.lineWidth = isSel ? 13 : 7;
        ctx.setLineDash(p.type === 'drain' ? [18,12] : []);
        ctx.beginPath();
        ctx.moveTo(offsetX + p.x1 * scale, offsetY + p.y1 * scale);
        ctx.lineTo(offsetX + p.x2 * scale, offsetY + p.y2 * scale);
        ctx.stroke();
      });
      ctx.setLineDash([]);

      // Fixtures
      fixtures.forEach(f => {
        drawFixture(f);

        if (selectedItem === f) {
          const px = offsetX + f.x * scale;
          const py = offsetY + f.y * scale;
          ctx.strokeStyle = '#d4af37';
          ctx.lineWidth = 9;
          ctx.strokeRect(px - 45, py - 45, 90, 90);
        }
      });
    }

    function worldX(sx) { return (sx - offsetX) / scale; }
    function worldY(sy) { return (sy - offsetY) / scale; }
    function snap(v) { return Math.round(v * 4) / 4; }

    function getClosestPipe(wx, wy) {
      let closest = -1;
      let minDist = Infinity;
      pipes.forEach((p, i) => {
        const dx = p.x2 - p.x1;
        const dy = p.y2 - p.y1;
        const len2 = dx*dx + dy*dy || 1;
        let t = ((wx - p.x1) * dx + (wy - p.y1) * dy) / len2;
        t = Math.max(0, Math.min(1, t));
        const projX = p.x1 + t * dx;
        const projY = p.y1 + t * dy;
        const dist = Math.hypot(wx - projX, wy - projY);
        if (dist < 0.65 && dist < minDist) {
          minDist = dist;
          closest = i;
        }
      });
      return closest;
    }

    function onMouseDown(e) {
      const rect = canvas.getBoundingClientRect();
      const sx = e.clientX - rect.left;
      const sy = e.clientY - rect.top;
      const wx = worldX(sx);
      const wy = worldY(sy);

      selectedItem = null;
      selectedPipeIndex = -1;

      // Fixtures
      for (let i = fixtures.length - 1; i >= 0; i--) {
        const f = fixtures[i];
        if (Math.hypot(f.x - wx, f.y - wy) < 1.2) {
          selectedItem = f;
          isDragging = true;
          dragOffsetX = wx - f.x;
          dragOffsetY = wy - f.y;
          updateInfoPanel();
          draw();
          return;
        }
      }

      // Pipes
      const pipeIdx = getClosestPipe(wx, wy);
      if (pipeIdx !== -1) {
        selectedPipeIndex = pipeIdx;
        isDragging = true;
        dragOffsetX = wx;
        dragOffsetY = wy;
        updateInfoPanel();
        draw();
        return;
      }

      if (['wall','hot','cold','drain'].includes(currentTool)) {
        drawingStart = {x: wx, y: wy, type: currentTool}; // exact for preview
      } else if (currentTool === 'erase') {
        fixtures = fixtures.filter(f => Math.hypot(f.x - wx, f.y - wy) > 1.3);
        walls = walls.filter(w => Math.min(Math.hypot(w.x1 - wx, w.y1 - wy), Math.hypot(w.x2 - wx, w.y2 - wy)) > 1.6);
        pipes = pipes.filter(p => Math.min(Math.hypot(p.x1 - wx, p.y1 - wy), Math.hypot(p.x2 - wx, p.y2 - wy)) > 1.6);
        draw();
      }
      updateInfoPanel();
    }

    function onMouseMove(e) {
      const rect = canvas.getBoundingClientRect();
      const sx = e.clientX - rect.left;
      const sy = e.clientY - rect.top;
      const wx = worldX(sx);
      const wy = worldY(sy);

      if (isDragging) {
        if (selectedItem) {
          selectedItem.x = snap(wx - dragOffsetX);
          selectedItem.y = snap(wy - dragOffsetY);
        } else if (selectedPipeIndex !== -1) {
          const p = pipes[selectedPipeIndex];
          const dx = wx - dragOffsetX;
          const dy = wy - dragOffsetY;
          p.x1 += dx;
          p.y1 += dy;
          p.x2 += dx;
          p.y2 += dy;
          dragOffsetX = wx;
          dragOffsetY = wy;
        }
        draw();
      } else if (drawingStart) {
        draw();
        ctx.strokeStyle = drawingStart.type === 'wall' ? '#3f2a1e' : drawingStart.type === 'hot' ? '#ef4444' : drawingStart.type === 'cold' ? '#3b82f6' : '#111827';
        ctx.lineWidth = drawingStart.type === 'wall' ? 9 : 7;
        ctx.setLineDash(drawingStart.type === 'drain' ? [18,12] : []);
        ctx.beginPath();
        ctx.moveTo(offsetX + drawingStart.x * scale, offsetY + drawingStart.y * scale);
        ctx.lineTo(offsetX + wx * scale, offsetY + wy * scale); // exact cursor
        ctx.stroke();
        ctx.setLineDash([]);
      }
    }

    function onMouseUp(e) {
      const rect = canvas.getBoundingClientRect();
      const sx = e.clientX - rect.left;
      const sy = e.clientY - rect.top;
      const wx = worldX(sx);
      const wy = worldY(sy);

      if (drawingStart) {
        const endX = snap(wx);
        const endY = snap(wy);
        if (drawingStart.type === 'wall') {
          walls.push({x1: drawingStart.x, y1: drawingStart.y, x2: endX, y2: endY});
        } else {
          pipes.push({x1: drawingStart.x, y1: drawingStart.y, x2: endX, y2: endY, type: drawingStart.type});
        }
        drawingStart = null;
        draw();
      }
      isDragging = false;
    }

    function onWheel(e) {
      const rect = canvas.getBoundingClientRect();
      const mouseX = e.clientX - rect.left;
      const mouseY = e.clientY - rect.top;

      if (selectedItem && e.shiftKey) {
        // Resize with Shift + Wheel
        const factor = e.deltaY < 0 ? 1.1 : 0.9;
        selectedItem.scale = (selectedItem.scale || 1) * factor;
        selectedItem.scale = Math.max(0.5, Math.min(2.5, selectedItem.scale));
        draw();
        e.preventDefault();
      } else if (selectedItem || selectedPipeIndex !== -1) {
        // Rotate
        const angle = e.deltaY * 0.008;
        if (selectedItem) {
          selectedItem.rotation = (selectedItem.rotation || 0) + angle;
        } else if (selectedPipeIndex !== -1) {
          const p = pipes[selectedPipeIndex];
          const cx = (p.x1 + p.x2) / 2;
          const cy = (p.y1 + p.y2) / 2;
          const dx1 = p.x1 - cx;
          const dy1 = p.y1 - cy;
          const dx2 = p.x2 - cx;
          const dy2 = p.y2 - cy;
          const cos = Math.cos(angle);
          const sin = Math.sin(angle);
          p.x1 = cx + dx1 * cos - dy1 * sin;
          p.y1 = cy + dx1 * sin + dy1 * cos;
          p.x2 = cx + dx2 * cos - dy2 * sin;
          p.y2 = cy + dx2 * sin + dy2 * cos;
        }
        draw();
        e.preventDefault();
      } else {
        // Zoom the view
        const factor = e.deltaY < 0 ? 1.15 : 0.87;
        const oldScale = scale;
        scale *= factor;
        offsetX = mouseX - (mouseX - offsetX) * (scale / oldScale);
        offsetY = mouseY - (mouseY - offsetY) * (scale / oldScale);
        draw();
        e.preventDefault();
      }
    }

    function setTool(tool) {
      currentTool = tool;
      document.querySelectorAll('.tool-btn').forEach(b => b.classList.remove('active'));
      const btn = document.getElementById('btn-' + tool);
      if (btn) btn.classList.add('active');
    }

    function addFixtureFromDropdown(select) {
      const val = select.value;
      if (!val) return;
      fixtures.push({type: val, x: snap(4 + Math.random()*3 - 1.5), y: snap(2.5 + Math.random()*3 - 1.5), rotation: 0, scale: 1});
      draw();
      select.value = '';
    }

    function updateInfoPanel() {
      const panel = document.getElementById('infoPanel');
      if (selectedItem) {
        panel.innerHTML = `<span class="text-2xl gold">${selectedItem.type.toUpperCase()}</span><br>Drag to move â€¢ Wheel to rotate â€¢ Shift + Wheel to resize`;
      } else if (selectedPipeIndex !== -1) {
        panel.innerHTML = `<span class="text-2xl gold">${pipes[selectedPipeIndex].type.toUpperCase()} PIPE</span><br>Drag to move â€¢ Wheel to rotate`;
      } else {
        panel.innerHTML = 'Click fixture/pipe to select â€¢ Drag to move â€¢ Wheel to rotate/zoom';
      }
    }

    function exitPlanner() {
      if (document.fullscreenElement) document.exitFullscreen();
      document.getElementById('plannerModal').classList.add('hidden');
    }

    // =============== OTHER FUNCTIONS ===============
    let basePrice = 9800;
    function updateEstimate() {
      const size = parseInt(document.getElementById('sizeSlider').value);
      let price = basePrice + (size * 850);
      document.querySelectorAll('#estimator input[type="checkbox"]:checked').forEach(c => {
        const match = c.parentElement.textContent.match(/\d+/);
        if (match) price += parseInt(match[0]) * 1000;
      });
      document.getElementById('estimatePrice').textContent = 'Â£' + price.toLocaleString();
      document.getElementById('sizeValue').textContent = size + ' mÂ²';
    }
    function setStyle(n) {
      document.querySelectorAll('.style-btn').forEach(b => b.classList.remove('active'));
      document.querySelectorAll('.style-btn')[n].classList.add('active');
      updateEstimate();
    }
    function saveEstimate() { alert("Estimate saved!"); }
    function toggleFAQ(el) {
      const answer = el.nextElementSibling;
      answer.classList.toggle('hidden');
      const sign = el.querySelector('span');
      sign.textContent = sign.textContent === '+' ? 'âˆ’' : '+';
    }
    document.getElementById('quoteForm').addEventListener('submit', (e) => {
      e.preventDefault();
      alert("Thank you! Our London team will call you within 2 hours.");
    });

    window.onload = () => {
      updateEstimate();
      if (localStorage.getItem('roomioBannerClosed') === 'true') {
        document.getElementById('roomioBanner').style.display = 'none';
      }
    };
  </script>
</body>
</html>
