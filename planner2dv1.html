<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>En-Suite & Bathroom 2D Planner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
<style>
body { margin:0; font-family:system-ui; background:#f1f3f6; overflow:hidden; }
header { height:60px; background:white; border-bottom:1px solid #e5e7eb; display:flex; align-items:center; padding:0 20px; font-weight:600; font-size:18px; }
#controls { height:60px; background:#ffffff; border-bottom:1px solid #e5e7eb; display:flex; align-items:center; gap:10px; padding:0 20px; flex-wrap: wrap; }
select, button { padding:6px 12px; border-radius:6px; border:1px solid #d1d5db; background:white; cursor:pointer; }
canvas { border:none; }
</style>
</head>
<body>

<header>En-Suite & Bathroom 2D Planner</header>

<div id="controls">
<select id="toolSelect">
<option value="select">Select Tool</option>
<option value="wall">Draw Wall</option>
<option value="erase">Erase</option>
</select>

<select id="fixtureSelect">
<option value="">Add Fixture</option>
<optgroup label="Sanitary">
<option value="toilet">Toilet</option>
<option value="bathAlcove">Alcove Bath</option>
<option value="bathFree">Freestanding Bath</option>
<option value="shower">Shower</option>
<option value="basinWall">Wall Hung Basin</option>
<option value="basinPedestal">Pedestal Basin</option>
<option value="bidet">Bidet</option>
</optgroup>
<optgroup label="Heating & Furniture">
<option value="towelRad">Towel Radiator</option>
<option value="vanity">Vanity Unit</option>
<option value="ledMirror">LED Mirror</option>
</optgroup>
<optgroup label="External / Others">
<option value="door">Door</option>
<option value="window">Window</option>
<option value="manhole">Manhole</option>
<option value="grass">Grass</option>
<option value="socket">Socket</option>
<option value="light">Light</option>
<option value="switch">Switch</option>
</optgroup>
</select>

<button onclick="rotateSelected()">Rotate 90Â°</button>
<button onclick="deleteSelected()">Delete</button>
<button onclick="exportPNG()">Export PNG</button>
</div>

<canvas id="c"></canvas>

<script>
const canvas = new fabric.Canvas('c', { selection:true });
canvas.setHeight(window.innerHeight - 120);
canvas.setWidth(window.innerWidth);
const GRID=50;

let tool="select";
let wallDrawing=false;
let wallLine;

// Draw grid
for(let i=0;i<1000;i++){
  canvas.add(new fabric.Line([i*GRID,0,i*GRID,10000],{stroke:'#e5e7eb', selectable:false, evented:false}));
  canvas.add(new fabric.Line([0,i*GRID,10000,i*GRID],{stroke:'#e5e7eb', selectable:false, evented:false}));
}

window.addEventListener("resize",()=>{
  canvas.setHeight(window.innerHeight - 120);
  canvas.setWidth(window.innerWidth);
  canvas.renderAll();
});

document.getElementById("toolSelect").onchange=function(){ tool=this.value; };
document.getElementById("fixtureSelect").onchange=function(){ if(this.value) addFixture(this.value); this.value=""; };

// Wall drawing
canvas.on("mouse:down", function(opt){
  if(tool==="wall"){
    wallDrawing=true;
    const p = canvas.getPointer(opt.e);
    wallLine=new fabric.Line([p.x,p.y,p.x,p.y],{ stroke:"#4b5563", strokeWidth:6, selectable:true });
    canvas.add(wallLine);
  } else if(tool==="erase"){
    const obj = canvas.findTarget(opt.e);
    if(obj) canvas.remove(obj);
  }
});

canvas.on("mouse:move",function(opt){
  if(wallDrawing){
    const p=canvas.getPointer(opt.e);
    wallLine.set({x2:p.x,y2:p.y});
    canvas.renderAll();
  }
});

canvas.on("mouse:up",function(){ wallDrawing=false; });

// Zoom & Pan
canvas.on("mouse:wheel",function(opt){
  let zoom = canvas.getZoom();
  zoom *= 0.999 ** opt.e.deltaY;
  zoom = Math.min(Math.max(zoom,0.2),3);
  canvas.zoomToPoint({x:opt.e.offsetX,y:opt.e.offsetY}, zoom);
  opt.e.preventDefault();
});

// Rotate / Delete / Export
function rotateSelected(){
  const obj = canvas.getActiveObject();
  if(obj){ obj.rotate((obj.angle||0)+90); canvas.renderAll(); }
}

function deleteSelected(){
  const obj = canvas.getActiveObject();
  if(obj) canvas.remove(obj);
}

function exportPNG(){
  const link=document.createElement("a");
  link.download="bathroom-plan.png";
  link.href=canvas.toDataURL({format:'png'});
  link.click();
}

// Fixtures with proper visual shapes
function addFixture(type){
  let obj;
  switch(type){
    case "toilet":
      obj=new fabric.Group([
        new fabric.Rect({width:60,height:40,fill:"#fff",stroke:"#111",strokeWidth:2,top:10,left:-30}),
        new fabric.Rect({width:40,height:60,fill:"#f3f4f6",stroke:"#111",strokeWidth:2,top:-30,left:-20}),
        new fabric.Rect({width:10,height:20,fill:"#999",stroke:"#111",strokeWidth:1,top:-35,left:-5}) // flush
      ]);
      break;
    case "bathAlcove":
      obj=new fabric.Group([
        new fabric.Rect({width:80,height:160,fill:"#dbeafe",rx:15,ry:15,stroke:"#0284c7",strokeWidth:2}),
        new fabric.Rect({width:20,height:10,fill:"#fbbf24",stroke:"#92400e",strokeWidth:1,top:-5,left:30}) // tap
      ]);
      break;
    case "bathFree":
      obj=new fabric.Group([
        new fabric.Rect({width:100,height:160,fill:"#dbeafe",rx:40,ry:40,stroke:"#0284c7",strokeWidth:2}),
        new fabric.Rect({width:20,height:10,fill:"#fbbf24",stroke:"#92400e",strokeWidth:1,top:-5,left:40}) // tap
      ]);
      break;
    case "shower":
      obj=new fabric.Group([
        new fabric.Rect({width:80,height:80,fill:"#bae6fd",stroke:"#0284c7",strokeWidth:2}),
        new fabric.Rect({width:15,height:15,fill:"#fbbf24",stroke:"#92400e",strokeWidth:1,top:10,left:10}) // tap
      ]);
      break;
    case "basinWall":
      obj=new fabric.Group([
        new fabric.Rect({width:50,height:40,fill:"#fef3c7",stroke:"#92400e",strokeWidth:2}),
        new fabric.Rect({width:10,height:10,fill:"#fbbf24",stroke:"#92400e",strokeWidth:1,top:5,left:20}) // tap
      ]);
      break;
    case "basinPedestal":
      obj=new fabric.Group([
        new fabric.Rect({width:50,height:50,fill:"#fef3c7",stroke:"#92400e",strokeWidth:2}),
        new fabric.Rect({width:10,height:10,fill:"#fbbf24",stroke:"#92400e",strokeWidth:1,top:5,left:20}) // tap
      ]);
      break;
    case "bidet":
      obj=new fabric.Rect({width:50,height:50,fill:"#fff",stroke:"#111",strokeWidth:2});
      break;
    case "towelRad":
      obj=new fabric.Rect({width:20,height:80,fill:"#f1f5f9",stroke:"#334155",strokeWidth:2});
      break;
    case "vanity":
      obj=new fabric.Rect({width:80,height:40,fill:"#fde68a",stroke:"#92400e",strokeWidth:2});
      break;
    case "ledMirror":
      obj=new fabric.Rect({width:60,height:60,fill:"#dbeafe",stroke:"#0284c7",strokeWidth:2});
      break;
    case "door":
      obj=new fabric.Rect({width:15,height:70,fill:"#78350f",stroke:"#111",strokeWidth:2});
      break;
    case "window":
      obj=new fabric.Rect({width:60,height:40,fill:"#dbeafe",stroke:"#0284c7",strokeWidth:2});
      break;
    case "manhole":
      obj=new fabric.Circle({radius:30,fill:"#1e2937",stroke:"#64748b",strokeWidth:3});
      break;
    case "grass":
      obj=new fabric.Rect({width:80,height:40,fill:"#4ade80",stroke:"#166534",strokeWidth:2});
      break;
    case "socket":
      obj=new fabric.Circle({radius:8,fill:"#fcd34d",stroke:"#b45309",strokeWidth:2});
      break;
    case "light":
      obj=new fabric.Circle({radius:12,fill:"#facc15",stroke:"#78350f",strokeWidth:2});
      break;
    case "switch":
      obj=new fabric.Rect({width:10,height:20,fill:"#fbbf24",stroke:"#b45309",strokeWidth:2});
      break;
  }
  obj.set({ left:300, top:300, hasRotatingPoint:true, cornerSize:12, transparentCorners:false });
  canvas.add(obj);
  canvas.setActiveObject(obj);
}
</script>
</body>
</html>
