<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>En-Suite & Bathroom 2D Planner</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
<style>
body{margin:0;font-family:system-ui;background:#f1f3f6;overflow:hidden;}
header{height:60px;background:white;border-bottom:1px solid #e5e7eb;display:flex;align-items:center;padding:0 20px;font-weight:600;font-size:18px;}
#controls{height:60px;background:#ffffff;border-bottom:1px solid #e5e7eb;display:flex;align-items:center;gap:10px;padding:0 20px;flex-wrap:wrap;}
select,button{padding:6px 12px;border-radius:6px;border:1px solid #d1d5db;background:white;cursor:pointer;}
</style>
</head>
<body>

<header>En-Suite & Bathroom 2D Planner</header>

<div id="controls">
<select id="toolSelect">
<option value="select">Select Tool</option>
<option value="wall">Draw Wall</option>
<option value="erase">Erase</option>
</select>

<select id="fixtureSelect">
<option value="">Add Fixture</option>
<option value="toilet">Toilet</option>
<option value="bath">Bath</option>
<option value="basin">Basin</option>
<option value="shower">Shower</option>
<option value="door">Door</option>
<option value="manhole">Manhole</option>
<option value="socket">Socket</option>
<option value="light">Light</option>
</select>

<button onclick="rotateSelected()">Rotate 90Â°</button>
<button onclick="deleteSelected()">Delete</button>
</div>

<canvas id="c"></canvas>

<script>
const canvas = new fabric.Canvas('c',{selection:true});
canvas.setHeight(window.innerHeight - 120);
canvas.setWidth(window.innerWidth);

const GRID=50;
for(let i=0;i<200;i++){
  canvas.add(new fabric.Line([i*GRID,0,i*GRID,10000],{stroke:'#e5e7eb', selectable:false, evented:false}));
  canvas.add(new fabric.Line([0,i*GRID,10000,i*GRID],{stroke:'#e5e7eb', selectable:false, evented:false}));
}

let tool="select";
let wallDrawing=false;
let wallLine=null;

document.getElementById("toolSelect").onchange=function(){ tool=this.value; };
document.getElementById("fixtureSelect").onchange=function(){ if(this.value) addFixture(this.value); this.value=""; };

canvas.on("mouse:down",function(opt){

  if(tool==="wall"){
    if(opt.target) return;
    wallDrawing=true;
    const p=canvas.getPointer(opt.e);
    wallLine=new fabric.Line([p.x,p.y,p.x,p.y],{
      stroke:"#374151",
      strokeWidth:12,
      selectable:true
    });
    canvas.add(wallLine);
  }

  if(tool==="erase"){
    if(opt.target) canvas.remove(opt.target);
  }

});

canvas.on("mouse:move",function(opt){
  if(wallDrawing && tool==="wall"){
    const p=canvas.getPointer(opt.e);
    wallLine.set({x2:p.x,y2:p.y});
    canvas.requestRenderAll();
  }
});

canvas.on("mouse:up",function(){ wallDrawing=false; });
canvas.on("object:moving",function(){ wallDrawing=false; });

function rotateSelected(){
  const obj=canvas.getActiveObject();
  if(obj){ obj.rotate((obj.angle||0)+90); canvas.renderAll(); }
}

function deleteSelected(){
  const obj=canvas.getActiveObject();
  if(obj) canvas.remove(obj);
}

function addSVG(svgString){
  fabric.loadSVGFromString(svgString,function(objects,options){
    const obj=fabric.util.groupSVGElements(objects,options);
    obj.set({
      left:300,
      top:300,
      originX:"center",
      originY:"center"
    });
    canvas.add(obj);
    canvas.setActiveObject(obj);
  });
}

function addFixture(type){

  const svgs={

toilet:`<svg viewBox="0 0 200 260">
<rect x="70" y="0" width="60" height="50" fill="white" stroke="black" stroke-width="4"/>
<ellipse cx="100" cy="150" rx="70" ry="90" fill="white" stroke="black" stroke-width="4"/>
<ellipse cx="100" cy="150" rx="35" ry="55" fill="white" stroke="black" stroke-width="3"/>
<circle cx="100" cy="25" r="6" fill="black"/>
</svg>`,

bath:`<svg viewBox="0 0 300 140">
<rect x="10" y="40" width="280" height="70" rx="50" fill="white" stroke="black" stroke-width="4"/>
<circle cx="230" cy="50" r="6" fill="black"/>
<circle cx="250" cy="50" r="6" fill="black"/>
</svg>`,

basin:`<svg viewBox="0 0 200 150">
<rect x="30" y="60" width="140" height="60" rx="25" fill="white" stroke="black" stroke-width="4"/>
<circle cx="100" cy="90" r="6" fill="black"/>
<rect x="85" y="20" width="30" height="30" fill="white" stroke="black" stroke-width="4"/>
</svg>`,

shower:`<svg viewBox="0 0 150 150">
<rect x="20" y="20" width="110" height="110" fill="white" stroke="black" stroke-width="4"/>
<circle cx="75" cy="75" r="8" fill="black"/>
</svg>`,

door:`<svg viewBox="0 0 200 200">
<line x1="20" y1="100" x2="180" y2="100" stroke="black" stroke-width="4"/>
<path d="M100 100 A80 80 0 0 1 180 20" fill="none" stroke="black" stroke-width="3"/>
</svg>`,

manhole:`<svg viewBox="0 0 150 150">
<circle cx="75" cy="75" r="60" fill="white" stroke="black" stroke-width="4"/>
</svg>`,

socket:`<svg viewBox="0 0 100 100">
<rect x="20" y="20" width="60" height="60" fill="white" stroke="black" stroke-width="3"/>
<circle cx="40" cy="50" r="5" fill="black"/>
<circle cx="60" cy="50" r="5" fill="black"/>
</svg>`,

light:`<svg viewBox="0 0 120 120">
<circle cx="60" cy="60" r="40" fill="white" stroke="black" stroke-width="4"/>
</svg>`

  };

  addSVG(svgs[type]);
}
</script>
</body>
</html>
